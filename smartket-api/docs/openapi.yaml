openapi: 3.0.0
info:
  title: SmartKet API
  description: Arquitectura SaaS Multitenant para Gestión de Negocios (HORECA, Retail, Services).
  version: 1.0.0
servers:
  - url: http://localhost:8000/api
    description: Servidor de Desarrollo Local

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  
  schemas:
    User:
      type: object
      properties:
        id: { type: integer }
        name: { type: string }
        email: { type: string }
        roles:
          type: array
          items: { type: string }

    Tenant:
      type: object
      properties:
        id: { type: integer }
        business_name: { type: string }
        slug: { type: string }
        business_type: { type: string }
        setup_complete: { type: boolean }

paths:
  /register:
    post:
      summary: Registro de nuevo negocio (Inquilino)
      tags: [Auth]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [business_name, email, password, business_type]
              properties:
                business_name: { type: string, example: "Pollería El Rayo" }
                email: { type: string, example: "owner@example.com" }
                password: { type: string, example: "Password123" }
                business_type: { type: string, enum: [polleria, minimarket, restaurante, farmacia] }
                plan: { type: string, example: "trial" }
      responses:
        201:
          description: Registro exitoso
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok: { type: boolean }
                  token: { type: string }
                  tenant_id: { type: integer }

  /login:
    post:
      summary: Autenticación de usuario o staff
      tags: [Auth]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [email, password]
              properties:
                email: { type: string }
                password: { type: string }
      responses:
        200:
          description: Login exitoso
          content:
            application/json:
              schema:
                type: object
                properties:
                  token: { type: string }
                  tenant_id: { type: integer }

  /me:
    get:
      summary: Obtener perfil del usuario autenticado y contexto del negocio
      tags: [Profile]
      security:
        - bearerAuth: []
      responses:
        200:
          description: Perfil devuelto
          content:
            application/json:
              schema:
                type: object
                properties:
                  user: { $ref: '#/components/schemas/User' }
                  tenant: { $ref: '#/components/schemas/Tenant' }

  /tenant/entitlements:
    get:
      summary: Obtener límites y permisos del plan actual
      tags: [Tenant]
      security:
        - bearerAuth: []
      responses:
        200:
          description: Lista de límites y módulos comprados
